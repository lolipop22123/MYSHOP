# üìã –°–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ CosmicPerks Bot

## üÜï –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. ‚≠ê –°–∏—Å—Ç–µ–º–∞ Telegram Premium –∏ Stars

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- **Telegram Premium –ø–æ–¥–ø–∏—Å–∫–∏** —á–µ—Ä–µ–∑ Fragment API (3, 9, 12 –º–µ—Å—è—Ü–µ–≤)
- **Telegram Stars** —á–µ—Ä–µ–∑ Fragment API (50, 100, 200, 500)
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Fragment API** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫—Ä–∏–ø—Ç–æ–ø–ª–∞—Ç–µ–∂–µ–π** —á–µ—Ä–µ–∑ Crypto Bot API

#### –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î:
- `premium_pricing` - —Ü–µ–Ω—ã –Ω–∞ Premium –ø–æ–¥–ø–∏—Å–∫–∏
- `user_balance` - –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `crypto_pay_invoices` - —Å—á–µ—Ç–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã

#### –ù–æ–≤—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
- `PremiumPricingRepository` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏ Premium
- `UserBalanceRepository` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `CryptoPayInvoiceRepository` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏ –æ–ø–ª–∞—Ç—ã

### 2. üë• –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

#### –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ UserRepository:
- `delete_user(user_id)` - —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∫–∞—Å–∫–∞–¥–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º

#### –ù–æ–≤—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
- `UserBalanceRepository` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - `get_user_balance()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
  - `add_to_balance()` - –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
  - `subtract_from_balance()` - —Å–Ω—è—Ç–∏–µ —Å –±–∞–ª–∞–Ω—Å–∞
  - `update_user_balance()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞

#### –ù–æ–≤—ã–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
- `admin_users_callback` - –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- `admin_find_user_callback` - –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID
- `handle_user_id_input` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `admin_add_balance_callback` - –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
- `admin_subtract_balance_callback` - —Å–Ω—è—Ç–∏–µ —Å –±–∞–ª–∞–Ω—Å–∞
- `handle_balance_amount` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—É–º–º—ã –±–∞–ª–∞–Ω—Å–∞
- `admin_delete_user_callback` - —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `admin_confirm_delete_callback` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
- `admin_proceed_delete_callback` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è

### 3. üîß –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–æ–º

#### –ù–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
- `admin_premium_pricing_callback` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏ Premium
- `admin_broadcast_callback` - —Ä–∞—Å—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- `handle_broadcast_text` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ —Ä–∞—Å—Å—ã–ª–∫–∏
- `admin_broadcast_confirm_callback` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∏

#### –ù–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM:
- `waiting_for_user_id` - –æ–∂–∏–¥–∞–Ω–∏–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `waiting_for_balance_amount` - –æ–∂–∏–¥–∞–Ω–∏–µ —Å—É–º–º—ã –±–∞–ª–∞–Ω—Å–∞
- `waiting_for_balance_operation` - –æ–∂–∏–¥–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–ª–∞–Ω—Å–æ–º
- `waiting_for_broadcast_text` - –æ–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Ä–∞—Å—Å—ã–ª–∫–∏
- `waiting_for_broadcast_confirm` - –æ–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–∞—Å—Å—ã–ª–∫–∏

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. **`bot/database/schema.sql`**
   - –£–¥–∞–ª–µ–Ω—ã —Ç–∞–±–ª–∏—Ü—ã: `categories`, `subcategories`, `products`, `orders`, `shop_settings`
   - –û—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è Premium, Stars –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

2. **`bot/database/models.py`**
   - –£–¥–∞–ª–µ–Ω—ã –º–æ–¥–µ–ª–∏: `Category`, `Subcategory`, `Product`, `Order`, `StarsPricing`
   - –û—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ: `User`, `Chat`, `Message`, `PremiumPricing`, `UserBalance`, `CryptoPayInvoice`

3. **`bot/database/repository.py`**
   - –£–¥–∞–ª–µ–Ω—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏: `CategoryRepository`, `SubcategoryRepository`, `ProductRepository`, `OrderRepository`, `ShopSettingsRepository`
   - –û—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ: `UserRepository`, `ChatRepository`, `MessageRepository`, `PremiumPricingRepository`, `UserBalanceRepository`, `CryptoPayInvoiceRepository`

4. **`bot/database/__init__.py`**
   - –û–±–Ω–æ–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –∏ —ç–∫—Å–ø–æ—Ä—Ç—ã
   - –£–¥–∞–ª–µ–Ω—ã —Å—Å—ã–ª–∫–∏ –Ω–∞ –º–∞–≥–∞–∑–∏–Ω

5. **`bot/handlers/user_handlers.py`**
   - –£–¥–∞–ª–µ–Ω –≤–µ—Å—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –º–∞–≥–∞–∑–∏–Ω–∞ –∏ —Ç–æ–≤–∞—Ä–æ–≤
   - –û—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ: –ø—Ä–æ—Ñ–∏–ª—å, –ø–æ–º–æ—â—å, –ø–æ–¥–¥–µ—Ä–∂–∫–∞, FAQ, Fragment API
   - –£–ø—Ä–æ—â–µ–Ω–æ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

6. **`bot/handlers/admin_handlers.py`**
   - –£–¥–∞–ª–µ–Ω –≤–µ—Å—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–æ–º
   - –û—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, Premium —Ü–µ–Ω—ã, —Ä–∞—Å—Å—ã–ª–∫–∞
   - –£–ø—Ä–æ—â–µ–Ω–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

7. **`bot/locales/translations.py`**
   - –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –ø–µ—Ä–µ–≤–æ–¥—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –º–∞–≥–∞–∑–∏–Ω–æ–º
   - –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ–∫—Å—Ç—ã –¥–ª—è Premium –∏ Stars
   - –£–ø—Ä–æ—â–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
1. **`init_db.py`** - —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
2. **`update_db.py`** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î
3. **`SETUP_INSTRUCTIONS.md`** - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
4. **`QUICK_START.md`** - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
5. **`CHANGES_SUMMARY.md`** - —ç—Ç–∞ —Å–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –£–¥–∞–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. **`update_shop_settings.py`** - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω

## üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:
- ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏** (–ø–æ–∏—Å–∫, –ø—Ä–æ—Å–º–æ—Ç—Ä, —É–¥–∞–ª–µ–Ω–∏–µ)
- ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º** (–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ/—Å–Ω—è—Ç–∏–µ)
- ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏ Premium** –ø–æ–¥–ø–∏—Å–æ–∫
- ‚úÖ **–†–∞—Å—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π** –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- ‚úÖ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** –±–æ—Ç–∞

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- ‚úÖ **–ü–æ–∫—É–ø–∫–∞ Telegram Premium** (3, 9, 12 –º–µ—Å—è—Ü–µ–≤)
- ‚úÖ **–ü–æ–∫—É–ø–∫–∞ Telegram Stars** (50, 100, 200, 500)
- ‚úÖ **–õ–∏—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å** —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- ‚úÖ **–ü–æ–º–æ—â—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞**
- ‚úÖ **–î–≤—É—è–∑—ã—á–Ω–æ—Å—Ç—å** (RU/EN)

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å—Ç–∞–≤—à–∏–µ—Å—è —Ç–∞–±–ª–∏—Ü—ã:
- **`users`** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–æ—Ç–∞
- **`chats`** - —á–∞—Ç—ã –∏ –≥—Ä—É–ø–ø—ã  
- **`messages`** - –ª–æ–≥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- **`premium_pricing`** - —Ü–µ–Ω—ã –Ω–∞ Premium
- **`user_balance`** - –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **`crypto_pay_invoices`** - —Å—á–µ—Ç–∞ –æ–ø–ª–∞—Ç—ã

### –£–¥–∞–ª–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
- ~~`categories`~~ - –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
- ~~`subcategories`~~ - –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- ~~`products`~~ - —Ç–æ–≤–∞—Ä—ã
- ~~`orders`~~ - –∑–∞–∫–∞–∑—ã
- ~~`shop_settings`~~ - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ë–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞ –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è:
- **Telegram Premium –ø–æ–¥–ø–∏—Å–æ–∫** —á–µ—Ä–µ–∑ Fragment API
- **Telegram Stars** —á–µ—Ä–µ–∑ Fragment API
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏** –∏ –∏—Ö –±–∞–ª–∞–Ω—Å–∞–º–∏
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π** –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞, —Ç–æ–≤–∞—Ä–æ–≤, –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω—ã. –ë–æ—Ç —Å—Ç–∞–ª –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏ —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –Ω–∞ —Å–≤–æ–µ–π –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–¥–∞—á–µ.

---

**CosmicPerks** —Ç–µ–ø–µ—Ä—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –Ω–∞ Telegram Premium –∏ Stars! üåü 